from db.db import database
from aiogram import Bot

# –°–ª–æ–≤–∞—Ä—å —Ç–µ–∫—Å—Ç–æ–≤ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
ACHIEVEMENTS_TEXTS = {
    "first_habit": (
        "üèÖ –ù–æ–≤–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: \"–ü–µ—Ä–≤—ã–π —à–∞–≥\"\n"
        "–¢—ã —Å–æ–∑–¥–∞–ª —Å–≤–æ—é –ø–µ—Ä–≤—É—é –ø—Ä–∏–≤—ã—á–∫—É!\n"
        "–° —ç—Ç–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Ç–≤–æ–π –ø—É—Ç—å –∫ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ —Å–µ–±—è. üöÄ"
    ),
    "first_challenge": (
        "üî• –ù–æ–≤–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: \"–í—ã–∑–æ–≤ –ø—Ä–∏–Ω—è—Ç\"\n"
        "–¢—ã –≤–∑—è–ª —Å–≤–æ–π –ø–µ—Ä–≤—ã–π —á–µ–ª–ª–µ–Ω–¥–∂!\n"
        "–¢–µ–ø–µ—Ä—å –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∏—Ç —Ç–µ–±—è –Ω–∞ –ø—Ä–æ—á–Ω–æ—Å—Ç—å. üí™"
    ),
    "streak_3": (
        "üèÜ –ù–æ–≤–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: \"–¢—Ä–∏—É–º—Ñ 3\"\n"
        "–¢—ã –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª –ø—Ä–∏–≤—ã—á–∫—É 3 –¥–Ω—è –ø–æ–¥—Ä—è–¥!\n"
        "–ù–∞—á–∞–ª–æ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –ø–æ–ª–æ–∂–µ–Ω–æ ‚Äî –ø—Ä–æ–¥–æ–ª–∂–∞–π!\n\n"
        "–ë–æ–ª—å—à–µ –º–æ—Ç–∏–≤–∞—Ü–∏–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –≤ –ø–æ–ª–Ω–æ–π –≤–µ—Ä—Å–∏–∏. –ü–æ–∑–≤–æ–ª—å –º–Ω–µ –±—ã—Ç—å —Ç–≤–æ–µ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π!"
    )
}

async def show_achievement(bot: Bot, user_id: int, code: str):
    """
    –í—ã–¥–∞—ë—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑.
    """
    text = ACHIEVEMENTS_TEXTS.get(code)
    if not text:
        return

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Ç–∞–∫–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ
    row = await database.fetch_one(
        "SELECT 1 FROM achievements WHERE user_id = :user_id AND code = :code",
        {"user_id": user_id, "code": code}
    )
    if row:
        return  # —É–∂–µ –≤—ã–¥–∞–≤–∞–ª–∏

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–∫—Ç –≤—ã–¥–∞—á–∏
    await database.execute(
        "INSERT INTO achievements (user_id, code) VALUES (:user_id, :code)",
        {"user_id": user_id, "code": code}
    )

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
    await bot.send_message(user_id, text)