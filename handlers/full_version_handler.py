from aiogram import Router, types, F
from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton, CallbackQuery
from config import ADMIN_ID
from keyboards.monetization import get_main_monetization_menu
from db.db import database  # –¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –∫ –ë–î
import logging


router = Router()


@router.message(F.text == "üì• –ü–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è")
async def handle_full_version(message: types.Message):
    logging.getLogger(__name__).info(
        f"[DEBUG] –ö–Ω–æ–ø–∫–∞ '–ü–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è' –Ω–∞–∂–∞—Ç–∞. text={repr(message.text)}, user_id={message.from_user.id}"
    )

    # –ü–æ–ª—É—á–∞–µ–º XP –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    query = "SELECT xp_balance FROM users WHERE user_id = :user_id"
    row = await database.fetch_one(query, {"user_id": message.from_user.id})
    xp = row[0] if row else 0

    # –ù–æ–≤—ã–π —Ç–µ–∫—Å—Ç
    text = (
        "üîì <b>YOUR AMBITIONS ‚Äî –±–æ–ª—å—à–µ, —á–µ–º –±–æ—Ç</b>\n"
        "–≠—Ç–æ <b>—Ç–≤–æ—è —Å–æ—Ü–∏–∞–ª—å–Ω–∞—è —Å–µ—Ç—å</b>, –µ—Å–ª–∏ —Ç—ã:\n"
        "‚Ä¢ –•–æ—á–µ—à—å –∏–∑–º–µ–Ω–∏—Ç—å –∂–∏–∑–Ω—å, –Ω–æ –Ω–µ –∑–Ω–∞–µ—à—å, —Å —á–µ–≥–æ –Ω–∞—á–∞—Ç—å\n"
        "‚Ä¢ –ò—â–µ—à—å —Å–∏–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ –µ–¥–∏–Ω–æ–º—ã—à–ª–µ–Ω–Ω–∏–∫–æ–≤\n"
        "‚Ä¢ –í–∏–¥–∏—à—å —Ü–µ–ª—å, –Ω–æ —á—É–≤—Å—Ç–≤—É–µ—à—å, —á—Ç–æ –¥–ª—è —Ä—ã–≤–∫–∞ —á–µ–≥–æ-—Ç–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç\n\n"
        "<b>–í –ü–û–õ–ù–û–ô –í–ï–†–°–ò–ò –¢–ï–ë–Ø –ñ–î–Å–¢:</b>\n"
        "‚úÖ –ë–µ–∑–ª–∏–º–∏—Ç –Ω–∞ –ø—Ä–∏–≤—ã—á–∫–∏ –∏ —á–µ–ª–ª–µ–Ω–¥–∂–∏\n"
        "üåç –ë–æ—Ç –Ω–∞ 3 —è–∑—ã–∫–∞—Ö (uk, ru, en) ‚Äî –≤—ã–±–∏—Ä–∞–π —Å–≤–æ–π\n"
        "üîî 3 —Ä–µ–∂–∏–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π: –º—è–≥–∫–∏–π, —Å—Ä–µ–¥–Ω–∏–π, –∂—ë—Å—Ç–∫–∏–π\n"
        "üìµ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–ª—é—á–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –º–µ–¥–∏–∞ –≤ –æ–±—â–∏–π —á–∞—Ç\n"
        "üìà –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞\n"
        "üí∏ –ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ –≤—ã–ø–ª–∞—Ç—ã –∑–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ ‚Äî –∑–æ–≤–∏ –¥—Ä—É–∑–µ–π –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π\n"
        "ü•á –õ–∏–≥–∏, —É—Ä–æ–≤–Ω–∏, –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è ‚Äî –¥–µ–ª–∞–π –ø—Ä–æ—Ü–µ—Å—Å —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–º\n"
        "üèÜ –¢–æ–ø-10 –≤ –º–∏—Ä–µ –∏ –≤ —Å–≤–æ–µ–π –ª–∏–≥–µ\n"
        "üë§ –ü—Ä–æ—Ñ–∏–ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ ‚Äî –Ω–∞—Ö–æ–¥–∏ –ª—é–¥–µ–π —Å —Ç–≤–æ–∏–º–∏ —Ü–µ–Ω–Ω–æ—Å—Ç—è–º–∏\n"
        "üìÖ –õ–∏—á–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏, –º–µ—á—Ç—ã, —Ü–µ–ª–∏, –ø–ª–∞–Ω—ã —Å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è–º–∏\n"
        "üéÅ –§–∏–∑–∏—á–µ—Å–∫–∏–µ –Ω–∞–≥—Ä–∞–¥—ã –æ—Ç –∫–æ–º–∞–Ω–¥—ã Your Ambitions\n\n"
        "‚ö°Ô∏è <b>–°–ï–ô–ß–ê–° –¢–í–û–ô –®–ê–ù–°</b>\n"
        "üéØ –° 60 —Ö—Ä ‚Äî —Å–∫–∏–¥–∫–∞ 30% –Ω–∞ –ø–æ–ª–Ω—É—é –≤–µ—Ä—Å–∏—é!\n"
        f"–£ —Ç–µ–±—è —Å–µ–π—á–∞—Å ‚Äî <b>{xp} —Ö—Ä</b>.\n\n"
        "–¢–µ–±–µ –Ω–µ –Ω—É–∂–Ω—ã —á—É–¥–µ—Å–∞.\n"
        "–¢–µ–±–µ –Ω—É–∂–µ–Ω –ø—Ä–æ–≥—Ä–µ—Å—Å.\n\n"
        "üî• –¢—ã –≤ –∏–≥—Ä–µ?"
    )

    # –õ–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ —Å—Å—ã–ª–∫–∏
    if xp >= 60:
        buy_url = "https://t.me/tribute/app?startapp=ssYz"
    else:
        buy_url = "https://t.me/yourambitionsbot"

    keyboard = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üî• –ü—Ä–∏–æ–±—Ä–µ—Å—Ç–∏ –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø", url=buy_url)],
        [InlineKeyboardButton(text="‚óÄÔ∏è –ù–∞–∑–∞–¥", callback_data="monetization_back")]
    ])

    await message.answer(text, reply_markup=keyboard, parse_mode="HTML")


@router.message(F.photo)
async def handle_photo(message: types.Message):
    # –ë–µ—Ä–µ–º —Å–∞–º–æ–µ –±–æ–ª—å—à–æ–µ –ø–æ –∫–∞—á–µ—Å—Ç–≤—É —Ñ–æ—Ç–æ
    photo = message.photo[-1]
    file_id = photo.file_id

    logging.getLogger(__name__).info(f"[PHOTO] file_id={file_id} from user_id={message.from_user.id}")
    print(f"[PHOTO] file_id={file_id} from user_id={message.from_user.id}")  # –¥–ª—è –≤—ã–≤–æ–¥–∞ –ø—Ä—è–º–æ –≤ –∫–æ–Ω—Å–æ–ª—å

    await message.answer(f"ID —ç—Ç–æ–π —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏:\n<code>{file_id}</code>", parse_mode="HTML")